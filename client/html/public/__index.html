<!DOCTYPE html>
<html ng-app="ngapp">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	{% block header %}
		<title>Web Feedback</title>
		<meta name="description" content="Initial waw client under angular 1.x and scss.">
		<meta name="keywords" content="waw, waw framework">
		<meta name="author" content="Honchar Denys">
	{% endblock %}
	<link rel="stylesheet" type="text/css" href="/gen/public.css">
	<link rel="stylesheet" type="text/css" href="/css/index.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-78236546-13"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());
		gtag('config', 'UA-78236546-13');
	</script>

</head>
<body ng-controller="main">

	{% block topbar %}
	<div  class="topbar">
		<div class="tb-logobox"><a href="/">WAW LOGO</a></div>
		{% if !user %}
			<span class="tb-login-links">
				<span  ng-click="login();">login</span>
				<span class="ml05 mr05">/</span>
				<span ng-click="sign();">Sign Up</span>
			</span>
		{% endif %}
		{% if user %}
			<span class="tb-login-links">
				<a href="/api/user/logout">Log Out</a>
			</span>
		{% endif %}
		<div class="tb-btn" ng-click="createReq();">Request review</div>

	</div>
	{% endblock %}
	<div class="body-part">
		{% block body %}{% endblock %}
	</div>
	<!-- Script -->
	{% block script %}
		<script src="/gen/public-min.js"></script>
		<script>
			var app = angular.module('ngapp',['wcom']);
			app.controller('main', function($scope, $http, modal, mongo, User, Request){
				setTimeout(function(){ 
					if(location.hash){
						var id = location.hash.slice(3);
						for (var i = 0; i < Request.requests.length; i++) {
							if(id==Request.requests[i]._id){
								var view = true;
				            	if(User._id==Request.requests[i].author){
				            		view = false;
				            	}
				            	for (var j = 0; j < Request.requests[i].feedbacks.length; j++) {
				            		if(Request.requests[i].feedbacks[j].author==User._id){
				            			view=false;
				            		}
				            	}
				                return modal.open({
				                    templateUrl: '/html/public/Request.html',
				                    request: Request.requests[i],
				                    full:true,
				                    view:view
				                });
							}
						}
					}
				 }, 100);
					

				$scope.login = function() {
	                modal.open({
	                    templateUrl: '/html/public/Login.html',
	                    sign: function() {
			                modal.open({
			                    templateUrl: '/html/public/Sign.html'
			                });
			            }
	                });
	            }
				$scope.sign = function() {
	                modal.open({
	                    templateUrl: '/html/public/Sign.html'
	                });
	            }
	            $scope.request = function(request) {
	            	var view = true;
	            	if(User._id==request.author){
	            		view = false;
	            	}
	            	for (var i = 0; i < request.feedbacks.length; i++) {
	            		if(request.feedbacks[i].author==User._id){
	            			view=false;
	            		}
	            	}
	                modal.open({
	                    templateUrl: '/html/public/Request.html',
	                    request: request,
	                    full:true,
	                    view:view
	                });
	                location.hash=request._id;
	            }
	            $scope.createReq = function() {
	                modal.open({
	                    templateUrl: '/html/public/createReq.html'
	                });
	            }
			});
		</script>
		<script src="/js/wcom/wcom.js"></script>
		<script src="/js/crud.js"></script>
		<script src="/js/public.js"></script>
	{% endblock %}
</body>
</html>