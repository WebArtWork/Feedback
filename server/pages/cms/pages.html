<!DOCTYPE html>
<html ng-app="app">
<head>
	<title>LIST</title>
	<link rel="stylesheet" href="https://raw.githack.com/WebArtWork/wcom/master/wcom-min.css">
	<link rel="stylesheet" href="/waw/pages/cms/cms.css">
</head>
<body ng-controller="main">
	
	<div class="topbar">
		<a class="wawlogo" href="/">
			<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 21.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
			<svg version="1.1" id="Слой_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="20px" x="0px" y="0px"
	 			viewBox="0 0 72.4 19.7" style="enable-background:new 0 0 72.4 19.7;" xml:space="preserve">
			<style type="text/css">
			</style>
			<g>
				<path class="st0" d="M48.8,19.1L48.8,19.1c-0.1,0-0.2,0-0.3,0c0,0-0.1,0-0.1,0C47.5,19,46,18.4,44.8,16l-8-15.7
				c-0.2-0.4-1-0.4-1.2,0l-8,15.7c-1.2,2.4-2.7,2.9-3.6,3.1c0,0-0.1,0-0.1,0c-0.1,0-0.2,0-0.3,0h0c-0.1,0-0.1,0-0.1,0.1v0.4
				c0,0.1,0.1,0.2,0.2,0.2h2h3H33c0.1,0,0.2-0.1,0.2-0.2v-0.3c0-0.1-0.1-0.2-0.3-0.2c-1.7,0-2.9-1.1-2.6-2.3c0.1-0.3,0.2-0.7,0.5-1.1
				c0.7-1,1.8-1.4,2.1-1.6c0.1-0.1,3-1.3,5.8-0.2c1.4,0.5,2.7,1.6,2.9,2.8c0,0.2,0.1,0.6-0.2,1.1c-0.4,0.8-1.5,1.2-1.8,1.3
				c-0.1,0-0.2,0-0.3,0c-0.2,0-0.3,0.1-0.3,0.2v0.3c0,0.1,0.1,0.2,0.2,0.2h4.3h3h2c0.1,0,0.2-0.1,0.2-0.2v-0.4
				C48.9,19.2,48.8,19.1,48.8,19.1z M37.4,12c-0.9,0.5-1.9,0.4-2,0.4c-0.3,0-1.2-0.1-1.9-0.6c-0.6-0.4-0.8-1-0.8-1.1
				c-0.4-1.2,0.6-2.4,1.4-3.4c0.8-1,1.9-2.4,3-2.2c0.8,0.1,1.1,1,1.4,1.7C39,8.2,39.3,10.9,37.4,12z"/>
				<path class="st0" d="M72.2,0.6h-2h-3h-2.6c-1.3-0.1-2.3,0-2.9,0.1c-0.5,0.1-1.3,0.2-2.1,0.6c-0.9,0.4-1.2,0.9-2,1.7
				c-0.9,0.9-1.9,1.8-3.3,2.4c-0.7,0.3-2.3,0.9-4,0.5c-0.9-0.2-1.7-0.7-2.2-1.3l-0.4-0.7c0-0.1-0.1-0.1-0.1-0.2c0,0,0,0,0-0.1
				c-0.1-0.5,0-0.9,0.2-1.2h0c0.4-0.7,1.3-1.2,2.4-1.2c0.2,0,0.3-0.1,0.3-0.2V0.8c0-0.1-0.1-0.2-0.2-0.2h-9.3c-0.1,0-0.2,0.1-0.2,0.2
				v0.4c0,0.1,0.1,0.1,0.1,0.1h0c0.1,0,0.2,0,0.3,0c0,0,0.1,0,0.1,0c0.8,0.1,2.3,0.6,3.6,3l8,15.2c0.2,0.4,1,0.4,1.2,0l2.5-4.7
				l2.5,4.7c0.2,0.4,1,0.4,1.2,0l8-15.2c1.2-2.3,2.7-2.9,3.6-3c0,0,0.1,0,0.1,0c0.1,0,0.2,0,0.3,0h0c0.1,0,0.1,0,0.1-0.1V0.8
				C72.4,0.7,72.3,0.6,72.2,0.6z M55.3,13.1c0,0.1-1,1.2-2.2,1c-0.8-0.1-1.2-0.6-1.4-0.8c-0.7-0.8-0.6-2-0.3-4.2
				c0-0.3,0.1-0.7,0.5-1.2C52,7.7,52.4,7.1,53.1,7c0.6-0.1,1.1,0.3,1.4,0.6c1,0.9,1.1,2.1,1.2,3.1C55.8,11.7,55.8,12.4,55.3,13.1z
				 M63.2,12.3c-0.1,0.8-0.8,1.7-1.9,2c-0.2,0.1-0.6,0.2-1.1,0.1c-1-0.2-1.5-1-1.9-1.7c-0.5-0.8-0.6-1.4-0.7-2.3
				c0-0.2-0.1-0.8,0.1-1.5c0.1-0.3,0.2-0.7,0.5-0.7c0.3,0,0.5,0.2,1,0.6c0.3,0.2,0.2,0.1,1.7,0.9c1,0.5,1.5,0.8,1.6,0.9
				C63.3,11.3,63.2,12.2,63.2,12.3z M64.9,7.3c-0.3,0.6-0.5,1.1-1.1,1.2c-0.1,0-0.4,0.1-1.1,0c-1.4-0.3-2.2-1-2.5-1.3
				c-0.5-0.5-1.1-1-1.2-1.9c-0.1-0.9,0.5-1.5,0.7-1.8c0.2-0.3,0.8-0.9,1.8-1.2c0.4-0.1,1.1-0.3,1.9-0.1c1,0.2,1.4,1,1.6,1.4
				c0.3,0.6,0.3,1.1,0.3,1.6C65.4,5.5,65.3,6.3,64.9,7.3z"/>
				<path class="st0" d="M31.3,0.6h-2h-3H22c-0.1,0-0.2,0.1-0.2,0.2V1c0,0.1,0.1,0.2,0.3,0.2c1.3,0,1.7,0.6,2.2,0.9
				c0.9,0.5,0.4,2.3-0.7,3.5c-0.2,0.2-1.5,1.5-3.5,1.6c-2.2,0-3.7-1.5-3.9-1.6c-0.8-0.8-1.2-1.9-2.5-3c-0.1-0.1-0.3-0.2-0.4-0.3
				C13,1.9,12.3,1.4,11.2,1C9.4,0.4,7.7,0.5,6.9,0.6H5.2h-3h-2C0.1,0.8,0.1,1,0,1.1c0,0.1,0.1,0.1,0.1,0.1h0c0.1,0,0.2,0,0.3,0
				c0,0,0.1,0,0.1,0c0.8,0.1,2.3,0.6,3.6,3l8,15.2c0.2,0.4,1,0.4,1.2,0l2.5-4.7l2.5,4.7c0.2,0.4,1,0.4,1.2,0l8-15.2
				c1.2-2.3,2.7-2.9,3.6-3c0,0,0.1,0,0.1,0c0.1,0,0.2,0,0.3,0h0c0.1,0,0.1,0,0.1-0.1V0.8C31.5,0.7,31.4,0.6,31.3,0.6z M8.9,8
				C7.7,7.8,7.1,7,6.6,6.3C6,5.5,5.2,4.4,5.9,3.3C6.5,2.3,7.9,2,8,2c1.9-0.4,3.8,0.6,4.6,1.6c0.2,0.2,0.6,0.8,0.6,1.5
				c0,1.2-1.2,1.9-1.4,2.1C11.5,7.5,10.3,8.3,8.9,8z M14.5,11.5c-0.6,1-1.4,2.4-2.4,2.4c-0.8,0-1.4-0.8-1.7-1.2
				c-0.6-1.1,0.1-2.1,0.5-2.7c0.2-0.3,0.9-0.9,2.3-2c1-0.8,1.4-1.1,1.7-1c0.4,0.1,0.4,0.7,0.5,1.2C15.4,10,14.6,11.3,14.5,11.5z
				 M19.9,15.1c-0.9,0.2-1.9-0.4-2.1-0.5c-1-0.6-1.1-1.4-1.2-2.4c-0.2-1.1,0.1-1.7,0.2-1.9C17,9.9,17.3,9.4,18,9.2
				c0.6-0.2,1.2,0,1.4,0c1.4,0.4,1.7,1.9,1.8,2.5C21.2,12,21.5,14.7,19.9,15.1z"/>
			</g>
			</svg>
		</a>
		<button ng-click="create()">
			<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 21.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
			<svg version="1.1" id="Слой_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25px" height="25px" x="0px" y="0px"
	 			viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" xml:space="preserve">
			<style type="text/css">
			</style>
			<g>
				<path class="st0" d="M18,5.6l-5.1-5.1C12.6,0.2,12.2,0,11.7,0H3.9C2.7,0,1.7,1,1.7,2.2v15.6c0,1.2,1,2.2,2.2,2.2h12.3
					c1.2,0,2.2-1,2.2-2.2v-11C18.5,6.3,18.3,5.9,18,5.6z M16.2,6.3h-3.9c0,0,0,0,0,0V2.3L16.2,6.3z M16.3,18.3H3.9
					c-0.3,0-0.5-0.2-0.5-0.5V2.2c0-0.3,0.2-0.5,0.5-0.5h6.6v4.5c0,1,0.8,1.8,1.8,1.8h4.4v9.7C16.7,18,16.5,18.3,16.3,18.3z"/>
				<polygon class="st0" points="9.9,9 8.1,9 8.1,11.9 5.2,11.9 5.2,13.7 8.1,13.7 8.1,16.6 9.9,16.6 9.9,13.7 12.8,13.7 12.8,11.9 
					9.9,11.9 	"/>
			</g>
			</svg>
		</button>
	</div>
	<!-- sidebar with users -->

	{% if is.pagesuper %}
	<div style="overflow-y: auto;" class="sidebar" ng-init="super=true; init();">
		Admins:
		<div  ng-repeat="user in admins">
			<input type="checkbox" ng-model="user.is.pagesuper" ng-change="updateUser(user);">
			{{user.name}}
			<button ng-if="!user.is.pagesuper" ng-click="user.is.pageadmin=false; updateUser(user);">X</button>

		</div>
		All users:
		<div  ng-repeat="user in users">
			<button ng-if="!user.is.pageadmin" ng-click="user.is.pageadmin=true; updateUser(user);">Add</button>
			{{user.name}}
		</div>
	</div>
	{% endif %}

	<!-- end of sidebar -->
	<div style="overflow-y: auto; height: 100%;">
		<div ng-repeat="page in pages"> 
			<input type="checkbox" ng-model="page.view" ng-change="update(page);">
			<a ng-href="/waw/pages/page/{{page._id}}" target="_self">{{page.title}}</a>
			<button ng-click="delete(page);">DELETE</button>

			<a ng-href="/waw/pages/page/{{page._id}}" target="_blank">EDIT</a>
			<a ng-if="page.view" ng-href="{{page.url}}" target="_blank">OPEN</a>
		</div>
	</div>
	




	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular.min.js"></script>
	<script type="text/javascript" src="https://raw.githack.com/WebArtWork/wcom/master/wcom-min.js"></script>

	<script type="text/javascript">
		var app = angular.module('app', ['wcom']);
		app.controller('main', function($scope, $http, modal, mongo){
			$scope.pages = mongo.get('pages');
			$scope.init=function(){
				$http.get('/waw/pages/get').then(function(resp){
					$scope.users = resp.data.users;
					$scope.admins = [];
					for (var i = $scope.users.length - 1; i >= 0; i--) {
						if($scope.users[i].is&&$scope.users[i].is.pageadmin){
							$scope.admins.push($scope.users[i]);
						}
					}
				});
			}

			$scope.delete = function(page){
				mongo.delete('pages', {
					_id: page._id
				});
			}
			$scope.create = function(){
				mongo.create('pages', function(created){
					window.location.href = "/waw/pages/page/"+created._id;
				});
			}
			$scope.update = function(page){
				mongo.afterWhile(page, function(){
					mongo.updateAll('pages', page);
				});
			}
			$scope.updateUser = function(user){
				$http.post('/waw/pages/post', user).then(function(resp){
					$scope.init();
				});	
			}
		});
	</script>

	<script type="text/ng-template" id="modal.html">
		<div>Are you sure?</div>
		<button ng-click="yes()">Yes</button>
		<button ng-click="close()">No</button>
	</script>
</body>
</html>